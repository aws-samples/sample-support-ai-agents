# Optira Web Chatbot Interface

A React-based web interface for the Optira Support Case Analysis system. This chatbot provides an intuitive way to query and analyze AWS support cases using natural language.

## Prerequisites

- Optira AI agents deployed in your AWS account (see optira-core repository)
- Node.js (v16 or later)
- AWS CLI configured with appropriate permissions

## Deployment

Deploy Cognito User Pool:

```bash
cd optira-web/deployment
./deploy.sh                    # Deploy to us-west-2 (default)
./deploy.sh us-east-1         # Deploy to specific region
```

**Important:** Deploy to the same region where your Optira AI agents are running. The Lambda function `OptiraAgentFunction` must exist in the target region.

Creates:
- Cognito User Pool: optira-users-{stack-name}-{account-id}
- Test user: testuser@example.com / TestPassword123!

**Note:** This is for development environment. Change the password after first login and create individual users. For production, follow AWS security best practices.

The deployment script automatically updates `.env` with the correct values:
```env
PORT=3000
REACT_APP_API_ENDPOINT=http://localhost:3001/api/chat
REACT_APP_COGNITO_USER_POOL_ID=<auto-generated>
REACT_APP_COGNITO_USER_POOL_WEB_CLIENT_ID=<auto-generated>
REACT_APP_AWS_REGION=<deployment-region>
```

**Deployment Recommendation:**
It is recommended to deploy this web interface in the same central account where the Optira AI agents are running, as by default it accesses Lambda functions directly (not using API Gateway). If you want to use API Gateway instead, update the `REACT_APP_API_ENDPOINT` environment variable to point to your API Gateway URL.

## Quick Start

```bash
# Navigate back to project root (after deployment)
cd ..

# Install dependencies
npm install

# Build and start the application
npm run build
./start.sh
```

The application will open at `http://localhost:3000` User: testuser@example.com / TestPassword123! (will be asked to change the password on first login)


## EC2 Deployment (Optional)

To deploy on EC2 instead of running locally:

1. Launch an EC2 instance (Amazon Linux 2 or Ubuntu)
2. Install Node.js and Git
3. Clone the repository and deploy Cognito
4. Configure security groups to allow HTTP traffic on ports 3000 and 3001
5. Run the application

Example EC2 setup:
```bash
# Install Node.js
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs git

# Setup
cd optira-web/deployment
./deploy.sh <your-region>
cd ..
npm install
npm run build

# Test manually first
./start.sh

# Once confirmed working, you can run in background with tmux (see steps below)
```

**Optional - Run with tmux (after testing manually):**
```bash
# Install tmux for session management
sudo yum install -y tmux

# Start application in tmux session
tmux new-session -d -s optira-web
tmux send-keys -t optira-web "cd $(pwd)" Enter
tmux send-keys -t optira-web "./start.sh" Enter
```

**Configure Security Groups:**
```bash
# Get your security group ID (run from EC2)
SECURITY_GROUP=$(aws ec2 describe-instances --instance-ids $(curl -s http://169.254.169.254/latest/meta-data/instance-id) --query 'Reservations[0].Instances[0].SecurityGroups[0].GroupId' --output text)

# Get your client machine's IP (run this command from your LOCAL machine)
curl -s https://checkip.amazonaws.com

# Set your client IP manually on EC2 (replace with the IP from above)
MY_IP=<your-client-ip-from-above>

# Open port 3000 (React app) - restrict to your client machine's IP
aws ec2 authorize-security-group-ingress --group-id $SECURITY_GROUP --protocol tcp --port 3000 --cidr $MY_IP/32

# Open port 3001 (API server) - restrict to your client machine's IP  
aws ec2 authorize-security-group-ingress --group-id $SECURITY_GROUP --protocol tcp --port 3001 --cidr $MY_IP/32

# Alternative: Allow from anywhere (less secure)
# aws ec2 authorize-security-group-ingress --group-id $SECURITY_GROUP --protocol tcp --port 3000 --cidr 0.0.0.0/0
# aws ec2 authorize-security-group-ingress --group-id $SECURITY_GROUP --protocol tcp --port 3001 --cidr 0.0.0.0/0
```

The application will open at `http://<your-ec2-public-ip>:3000`. User: testuser@example.com / TestPassword123! (will be asked to change the password on first login)

## Usage

Try these sample queries:

**Basic Analytics:**
- "Total count of support cases in jan 2025"
- "Give me OpenSearch Support cases in Jan 2025"
- "Can you provide OpenSearch case distribution based on severity?"

**Advanced Analysis:**
- "Find accounts with frequent high-priority support cases since January 2024, excluding limit increase requests. For each account and AWS service combination, show the total number of cases and how many different days had issues. Only include results where there were more than 3 cases, and sort results by the highest number of cases first."
- "Find accounts that experienced high-severity issues across multiple AWS services since January 2024, excluding limit increase requests. Show how many different services were involved, total number of cases, and the number of unique days with issues. Only include accounts that had problems with more than 2 different services, and sort results by the number of services involved (highest first), then by total cases."
- "For high-severity support cases since January 1, 2024, show the number of total cases and after-hours cases for each account and service combination. Define after-hours as before 1 PM UTC, after 1 AM UTC, or any time on weekends. Only include results with more than 3 after-hours cases. Sort by the highest number of after-hours cases. Exclude limit increase requests."

## Architecture

```
web/
├── deployment/       # CloudFormation templates (Cognito)
├── public/          # Static files
├── src/
│   ├── components/  # React components
│   ├── App.js       # Main application
│   └── aws-config.js # AWS Cognito configuration
├── package.json     # Dependencies
└── .env            # Configuration
```

**Ports:**
- React App: http://localhost:3000 (Web interface)
- API Server: http://localhost:3001 (Proxy server for Lambda calls)

**Authentication:**
- Uses AWS Cognito User Pool for authentication
- Deployed via CloudFormation in `deployment/` directory

**Deployment Recommendation:**
It is recommended to deploy this web interface in the same central account where the Optira AI agents are running, as by default it accesses Lambda functions directly (not using API Gateway). If you want to use API Gateway instead, update the `REACT_APP_API_ENDPOINT` environment variable to point to your API Gateway URL.

**Note:** This web interface directly calls Lambda functions. You can also access the application API via API Gateway. Refer to the optira-core repository for instructions to access API Gateway.

## Scripts

- `npm start` - Start development server
- `npm run build` - Build for production
- `npm test` - Run tests
